<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Desafio Jo√£o Victor</title>
    
    <!-- PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/trophy.png">
    
    <!-- Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.08);
        }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden selection:bg-emerald-500/30">

    <div id="root" class="h-full w-full overflow-y-auto no-scrollbar relative"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONS (SVG Nativos) ---
        const Icons = {
            Trophy: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
            Settings: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Ruler: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0l12.6 12.6z"/><line x1="14.5" x2="15.5" y1="12.5" y2="13.5"/><line x1="11.5" x2="12.5" y1="9.5" y2="10.5"/><line x1="8.5" x2="9.5" y1="6.5" y2="7.5"/><line x1="5.5" x2="6.5" y1="3.5" y2="4.5"/></svg>,
            ChevronLeft: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            Target: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            Waves: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></svg>,
            Flame: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
            Dumbbell: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6.5 6.5 11 11"/><path d="m21 21-1-1"/><path d="m3 3 1 1"/><path d="m18 22 4-4"/><path d="m2 6 4-4"/><path d="m3 10 7-7"/><path d="m14 21 7-7"/></svg>,
            Utensils: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>,
            Scale: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>,
            Moon: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Download: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            Activity: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
            TrendingUp: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
            User: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Edit: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Save: (p) => <svg {...p} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        };

        // --- DADOS INICIAIS ---
        const JOAO_DATA = {
            weight: 92.5,
            bodyFat: 30.1,
            muscle: 33.3,
            visceral: 9,
            measurements: {
                chest: 102, waist: 92, abdomen: 104, hip: 112.5,
                armL: 35.5, armR: 35.5, forearmL: 28, forearmR: 28,
                thighL: 70, thighR: 71, calfL: 40.5, calfR: 41
            }
        };

        // NOVAS METAS PADR√ÉO
        const DEFAULT_GOALS = {
            protein: 200, carbs: 140, fat: 50,
            workoutsPerWeek: 8,
            monthlyWorkouts: 32,
            natacao: 3, crossfit: 2, musculacao: 3
        };

        const QUICK_ADDS = [
            { name: '100g Frango/Carne', p: 30, c: 0, f: 5, icon: 'üçó' },
            { name: '1 Ovo Inteiro', p: 6, c: 0.5, f: 5, icon: 'ü•ö' },
            { name: '100g Arroz', p: 2.5, c: 28, f: 0.2, icon: 'üçö' },
            { name: '1 Banana', p: 1, c: 23, f: 0, icon: 'üçå' },
            { name: '1 Scoop Whey', p: 20, c: 3, f: 1, icon: 'üí™' },
            { name: '10g Azeite', p: 0, c: 0, f: 10, icon: 'ü´í' },
            { name: '100g Batata', p: 2, c: 17, f: 0, icon: 'ü•î' }
        ];

        function App() {
            // --- ESTADOS ---
            const [history, setHistory] = useState([]);
            const [startDate, setStartDate] = useState(new Date('2025-12-01T00:00:00'));
            const [currentDate, setCurrentDate] = useState(new Date().toISOString().split('T')[0]);
            
            // Estado de Metas (Carrega do storage ou usa padr√£o)
            const [goals, setGoals] = useState(() => {
                const savedGoals = localStorage.getItem('jv_goals_config');
                return savedGoals ? JSON.parse(savedGoals) : DEFAULT_GOALS;
            });

            // Log Di√°rio
            const [dailyLog, setDailyLog] = useState({
                protein: 0, carbs: 0, fat: 0, 
                weight: '', bodyFat: '', muscle: '', 
                sleepHours: '', isRestDay: false, workouts: [],
                measurements: null
            });
            
            // Modais e UI
            const [showSettings, setShowSettings] = useState(false);
            const [showMeasurements, setShowMeasurements] = useState(false);
            const [showGoalEditor, setShowGoalEditor] = useState(false);
            const fileInputRef = useRef(null);

            // --- EFEITOS DE CARREGAMENTO ---
            useEffect(() => {
                const savedData = localStorage.getItem('jv_desafio_data');
                if (savedData) {
                    setHistory(JSON.parse(savedData));
                } else {
                    const initialLog = {
                        date: '2025-12-01',
                        protein: 0, carbs: 0, fat: 0,
                        weight: JOAO_DATA.weight,
                        bodyFat: JOAO_DATA.bodyFat,
                        muscle: JOAO_DATA.muscle,
                        measurements: JOAO_DATA.measurements,
                        workouts: []
                    };
                    setHistory([initialLog]);
                    localStorage.setItem('jv_desafio_data', JSON.stringify([initialLog]));
                }
            }, []);

            // Salvar metas sempre que mudarem
            useEffect(() => {
                localStorage.setItem('jv_goals_config', JSON.stringify(goals));
            }, [goals]);

            // Sincronizar DailyLog
            useEffect(() => {
                const log = history.find(h => h.date === currentDate);
                if (log) {
                    setDailyLog(log);
                } else {
                    const lastLog = history[0]; 
                    setDailyLog({
                        protein: 0, carbs: 0, fat: 0, 
                        weight: lastLog?.weight || '', 
                        bodyFat: lastLog?.bodyFat || '',
                        muscle: lastLog?.muscle || '',
                        sleepHours: '', isRestDay: false, workouts: [],
                        measurements: null,
                        date: currentDate
                    });
                }
            }, [currentDate, history]);

            // --- FUN√á√ïES DE DADOS ---
            const saveData = (newLog) => {
                const updatedLog = { ...newLog, date: currentDate };
                setDailyLog(updatedLog);

                let newHistory = [...history];
                const idx = newHistory.findIndex(h => h.date === currentDate);
                if (idx >= 0) newHistory[idx] = updatedLog;
                else newHistory.push(updatedLog);

                newHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
                setHistory(newHistory);
                localStorage.setItem('jv_desafio_data', JSON.stringify(newHistory));
            };

            const updateField = (field, val) => saveData({ ...dailyLog, [field]: val });
            const updateMeasurement = (key, val) => {
                const currentM = dailyLog.measurements || {};
                saveData({ ...dailyLog, measurements: { ...currentM, [key]: parseFloat(val) } });
            };
            const updateMacro = (type, val, isAbsolute = false) => {
                const current = parseFloat(dailyLog[type]) || 0;
                const newValue = isAbsolute ? parseFloat(val) : Math.max(0, current + val);
                updateField(type, newValue);
            };
            const toggleWorkout = (type) => {
                if (dailyLog.isRestDay) return;
                let workouts = dailyLog.workouts || [];
                if (workouts.includes(type)) workouts = workouts.filter(w => w !== type);
                else workouts = [...workouts, type];
                saveData({ ...dailyLog, workouts });
            };

            // --- C√ÅLCULOS ---
            const getDayNumber = () => Math.floor((new Date(currentDate) - startDate) / 86400000) + 1;
            
            const dailyScore = useMemo(() => {
                let s = 0;
                if (dailyLog.workouts?.length > 0) s += 50;
                s += Math.min(1, (dailyLog.protein || 0) / goals.protein) * 50;
                return Math.round(s);
            }, [dailyLog, goals]);

            const weeklyStats = useMemo(() => {
                const d = new Date(currentDate);
                const day = d.getDay();
                const start = new Date(d); start.setDate(d.getDate() - day); start.setHours(0,0,0,0);
                const end = new Date(start); end.setDate(start.getDate() + 6); end.setHours(23,59,59,999);

                let stats = { natacao: 0, crossfit: 0, musculacao: 0, total: 0 };
                history.forEach(h => {
                    const hDate = new Date(h.date + 'T12:00:00');
                    if (hDate >= start && hDate <= end && h.workouts) {
                        h.workouts.forEach(w => { if(stats[w] !== undefined) stats[w]++; });
                        if(h.workouts.length > 0) stats.total++;
                    }
                });
                return stats;
            }, [history, currentDate]);

            // --- UI HELPERS ---
            const exportCSV = () => {
                if (history.length === 0) return alert("Sem dados.");
                const headers = "Data,Peso,Gordura%,Musculo%,Torax,Cintura,Abdome,Quadril,Proteina,Carbo,Gordura\n";
                const rows = history.map(h => {
                    const m = h.measurements || {};
                    return `${h.date},${h.weight||''},${h.bodyFat||''},${h.muscle||''},${m.chest||''},${m.waist||''},${m.abdomen||''},${m.hip||''},${h.protein},${h.carbs},${h.fat}`;
                }).join("\n");
                const blob = new Blob([headers + rows], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = 'jv_dados.csv'; a.click();
            };

            const backupData = () => {
                const blob = new Blob([JSON.stringify({ history, goals })], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `backup_jv_${currentDate}.json`; a.click();
            };

            const importBackup = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (data.history) {
                            if (confirm('Sobrescrever tudo com este backup?')) {
                                setHistory(data.history);
                                if (data.goals) setGoals(data.goals);
                                localStorage.setItem('jv_desafio_data', JSON.stringify(data.history));
                                if (data.goals) localStorage.setItem('jv_goals_config', JSON.stringify(data.goals));
                                alert('Restaurado!');
                                window.location.reload();
                            }
                        }
                    } catch (err) { alert('Erro no arquivo'); }
                };
                reader.readAsText(file);
            };

            return (
                <div className="min-h-full pb-20">
                    {/* --- HEADER --- */}
                    <div className="bg-slate-900 border-b border-slate-800 sticky top-0 z-30 px-4 pt-safe pb-2 shadow-xl">
                        <div className="flex justify-between items-center mb-3">
                            <div className="flex items-center gap-3">
                                <div className="bg-yellow-500/10 p-2 rounded-xl border border-yellow-500/20">
                                    <Icons.Trophy className="text-yellow-500 w-5 h-5" />
                                </div>
                                <div>
                                    <h1 className="font-bold text-white text-lg leading-none">Desafio JV</h1>
                                    <p className="text-xs text-emerald-400 font-bold uppercase mt-0.5">Dia {getDayNumber()}</p>
                                </div>
                            </div>
                            
                            <div className="flex gap-2">
                                {/* Bot√£o Editar Metas */}
                                <button onClick={() => setShowGoalEditor(true)} className="p-2 bg-slate-800 rounded-full text-blue-400 hover:text-blue-300 transition-colors border border-slate-700/50">
                                    <Icons.Edit className="w-5 h-5" />
                                </button>
                                {/* Bot√£o Configura√ß√µes */}
                                <button onClick={() => setShowSettings(true)} className="p-2 bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors border border-slate-700/50">
                                    <Icons.Settings className="w-5 h-5" />
                                </button>
                            </div>
                        </div>
                        
                        <div className="flex items-center justify-between bg-slate-800 rounded-lg p-1 border border-slate-700">
                            <button onClick={() => { const d=new Date(currentDate); d.setDate(d.getDate()-1); setCurrentDate(d.toISOString().split('T')[0]); }} className="p-2 text-slate-400"><Icons.ChevronLeft className="w-5 h-5"/></button>
                            <input type="date" value={currentDate} onChange={(e) => setCurrentDate(e.target.value)} className="bg-transparent text-center font-bold text-slate-200 outline-none text-sm" />
                            <button onClick={() => { const d=new Date(currentDate); d.setDate(d.getDate()+1); setCurrentDate(d.toISOString().split('T')[0]); }} className="p-2 text-slate-400"><Icons.ChevronRight className="w-5 h-5"/></button>
                        </div>
                    </div>

                    <main className="p-4 space-y-6 max-w-md mx-auto">
                        
                        {/* SCORE CARD */}
                        <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-2xl border border-slate-700 shadow-xl relative overflow-hidden">
                            <div className="flex justify-between items-end relative z-10">
                                <div>
                                    <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-1">Performance Di√°ria</p>
                                    <p className="text-4xl font-black text-white">{dailyScore}%</p>
                                </div>
                                <div className={`p-3 rounded-xl border ${dailyScore>=100?'bg-emerald-500/20 border-emerald-500/50 text-emerald-400':'bg-slate-800 border-slate-700 text-slate-500'}`}>
                                    <Icons.Target className="w-6 h-6" />
                                </div>
                            </div>
                            <div className="mt-4 h-1.5 bg-slate-950 rounded-full overflow-hidden relative z-10">
                                <div className={`h-full transition-all duration-700 ${dailyScore>=100?'bg-emerald-500':'bg-blue-500'}`} style={{width: `${dailyScore}%`}}></div>
                            </div>
                        </div>

                        {/* ESTAT√çSTICAS TREINO (Usando State goals) */}
                        <div className="grid grid-cols-2 gap-3">
                            <StatsBox label="Semana" value={weeklyStats.total} target={goals.workoutsPerWeek} color="blue" />
                            <StatsBox label="M√™s (Meta)" value={weeklyStats.total * 4} target={goals.monthlyWorkouts} color="purple" />
                        </div>

                        {/* INPUTS R√ÅPIDOS */}
                        <div className="bg-slate-800/50 border border-slate-700 p-4 rounded-xl">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xs font-bold text-slate-300 uppercase flex items-center gap-2"><Icons.User className="w-4 h-4 text-blue-400"/> Medidas</h3>
                                <button onClick={() => setShowMeasurements(true)} className="text-[10px] bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded flex items-center gap-1">
                                    <Icons.Ruler className="w-3 h-3"/> Detalhes
                                </button>
                            </div>
                            <div className="grid grid-cols-3 gap-3">
                                <QuickInput label="Peso (kg)" val={dailyLog.weight} change={v => updateField('weight', v)} />
                                <QuickInput label="Gordura %" val={dailyLog.bodyFat} change={v => updateField('bodyFat', v)} color="text-yellow-400" />
                                <QuickInput label="M√∫sculo %" val={dailyLog.muscle} change={v => updateField('muscle', v)} color="text-red-400" />
                            </div>
                        </div>

                        {/* TREINOS */}
                        <section>
                            <div className="flex justify-between items-center mb-2 px-1">
                                <h3 className="text-sm font-bold text-slate-300 flex items-center gap-2"><Icons.Dumbbell className="w-4 h-4 text-purple-400"/> Treinos</h3>
                                <button onClick={() => updateField('isRestDay', !dailyLog.isRestDay)} className={`text-[10px] px-2 py-1 rounded border ${dailyLog.isRestDay ? 'bg-emerald-900/20 border-emerald-800 text-emerald-400' : 'bg-slate-800 border-slate-700 text-slate-500'}`}>
                                    {dailyLog.isRestDay ? 'Descanso Ativo' : 'Marcar Descanso'}
                                </button>
                            </div>
                            <div className={`grid grid-cols-3 gap-3 ${dailyLog.isRestDay ? 'opacity-50 pointer-events-none' : ''}`}>
                                <WorkoutCard title="Nata√ß√£o" icon={<Icons.Waves/>} current={weeklyStats.natacao} target={goals.natacao} active={dailyLog.workouts?.includes('natacao')} onClick={() => toggleWorkout('natacao')} color="cyan" />
                                <WorkoutCard title="CrossFit" icon={<Icons.Flame/>} current={weeklyStats.crossfit} target={goals.crossfit} active={dailyLog.workouts?.includes('crossfit')} onClick={() => toggleWorkout('crossfit')} color="orange" />
                                <WorkoutCard title="Muscula√ß√£o" icon={<Icons.Dumbbell/>} current={weeklyStats.musculacao} target={goals.musculacao} active={dailyLog.workouts?.includes('musculacao')} onClick={() => toggleWorkout('musculacao')} color="purple" />
                            </div>
                        </section>

                        {/* MACROS */}
                        <section className="glass p-4 rounded-xl">
                            <h3 className="text-sm font-bold text-slate-200 mb-4 flex items-center gap-2"><Icons.Utensils className="w-4 h-4 text-rose-400"/> Macros</h3>
                            <div className="space-y-5">
                                <MacroRow label="Prote√≠na" type="protein" val={dailyLog.protein} target={goals.protein} color="bg-emerald-500" text="text-emerald-400" update={updateMacro} />
                                <MacroRow label="Carboidrato" type="carbs" val={dailyLog.carbs} target={goals.carbs} color="bg-blue-500" text="text-blue-400" update={updateMacro} />
                                <MacroRow label="Gordura" type="fat" val={dailyLog.fat} target={goals.fat} color="bg-yellow-500" text="text-yellow-400" update={updateMacro} />
                            </div>
                        </section>

                        {/* ADD R√ÅPIDO */}
                        <section>
                            <h3 className="text-[10px] font-bold text-slate-500 uppercase mb-2 px-1">Adi√ß√£o R√°pida</h3>
                            <div className="grid grid-cols-2 gap-2">
                                {QUICK_ADDS.map((item, i) => (
                                    <button key={i} onClick={() => {
                                        saveData({
                                            ...dailyLog,
                                            protein: (dailyLog.protein||0) + item.p,
                                            carbs: (dailyLog.carbs||0) + item.c,
                                            fat: (dailyLog.fat||0) + item.f
                                        });
                                    }} className="bg-slate-800 border border-slate-700 hover:bg-slate-700/80 p-3 rounded-xl flex items-center gap-3 text-left transition-colors">
                                        <span className="text-xl">{item.icon}</span>
                                        <div>
                                            <p className="text-xs font-bold text-slate-200">{item.name}</p>
                                            <div className="text-[10px] text-slate-400 flex gap-2 mt-0.5">
                                                {item.p > 0 && <span className="text-emerald-400">P:{item.p}</span>}
                                                {item.c > 0 && <span className="text-blue-400">C:{item.c}</span>}
                                                {item.f > 0 && <span className="text-yellow-400">F:{item.f}</span>}
                                            </div>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </section>

                        {/* GR√ÅFICO (Moved to bottom) */}
                        <div className="glass rounded-xl p-4">
                             <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xs font-bold text-slate-300 uppercase flex items-center gap-2">
                                    <Icons.TrendingUp className="w-4 h-4 text-emerald-400"/> Evolu√ß√£o
                                </h3>
                                <div className="text-[10px] bg-slate-800 px-2 py-1 rounded text-slate-400">Inicio: 92.5kg</div>
                            </div>
                            <Charts history={history} />
                        </div>
                    </main>

                    {/* MODAL EDITOR DE METAS */}
                    {showGoalEditor && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" onClick={() => setShowGoalEditor(false)}>
                            <div className="bg-slate-900 border border-slate-800 w-full max-w-sm rounded-3xl p-6 relative slide-up h-auto max-h-[85vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2"><Icons.Edit className="w-5 h-5 text-blue-400"/> Editar Metas</h2>
                                    <button onClick={() => setShowGoalEditor(false)} className="text-sm text-slate-400">Fechar</button>
                                </div>
                                
                                <div className="space-y-6">
                                    {/* Nutri√ß√£o */}
                                    <div>
                                        <h3 className="text-xs font-bold text-emerald-400 uppercase mb-3 border-b border-slate-800 pb-1">Nutri√ß√£o Di√°ria (g)</h3>
                                        <div className="grid grid-cols-3 gap-3">
                                            <GoalInput label="Prote√≠na" val={goals.protein} change={v => setGoals({...goals, protein: parseFloat(v)})} />
                                            <GoalInput label="Carbo" val={goals.carbs} change={v => setGoals({...goals, carbs: parseFloat(v)})} />
                                            <GoalInput label="Gordura" val={goals.fat} change={v => setGoals({...goals, fat: parseFloat(v)})} />
                                        </div>
                                    </div>

                                    {/* Treinos Semanais */}
                                    <div>
                                        <h3 className="text-xs font-bold text-blue-400 uppercase mb-3 border-b border-slate-800 pb-1">Treinos / Semana</h3>
                                        <div className="grid grid-cols-2 gap-3 mb-3">
                                            <GoalInput label="Meta Total" val={goals.workoutsPerWeek} change={v => setGoals({...goals, workoutsPerWeek: parseFloat(v)})} />
                                            <GoalInput label="Meta Mensal" val={goals.monthlyWorkouts} change={v => setGoals({...goals, monthlyWorkouts: parseFloat(v)})} />
                                        </div>
                                        <div className="grid grid-cols-3 gap-3">
                                            <GoalInput label="Nata√ß√£o" val={goals.natacao} change={v => setGoals({...goals, natacao: parseFloat(v)})} />
                                            <GoalInput label="CrossFit" val={goals.crossfit} change={v => setGoals({...goals, crossfit: parseFloat(v)})} />
                                            <GoalInput label="Muscula√ß√£o" val={goals.musculacao} change={v => setGoals({...goals, musculacao: parseFloat(v)})} />
                                        </div>
                                    </div>
                                    
                                    <button onClick={() => setShowGoalEditor(false)} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2">
                                        <Icons.Save className="w-4 h-4"/> Salvar Altera√ß√µes
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL SETTINGS (Mantido simples) */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4" onClick={() => setShowSettings(false)}>
                            <div className="bg-slate-900 border border-slate-800 w-full max-w-sm rounded-3xl p-6 relative slide-up" onClick={e => e.stopPropagation()}>
                                <h2 className="text-xl font-bold mb-4 text-white">Configura√ß√µes</h2>
                                <div className="space-y-3">
                                    <button onClick={backupData} className="w-full bg-slate-800 p-3 rounded-xl flex items-center justify-center gap-2 text-sm font-bold text-slate-300">
                                        <Icons.Download className="w-4 h-4"/> Backup JSON
                                    </button>
                                    <label className="w-full bg-slate-800 p-3 rounded-xl flex items-center justify-center gap-2 text-sm font-bold text-slate-300 cursor-pointer">
                                        <Icons.Upload className="w-4 h-4"/> Restaurar Backup
                                        <input ref={fileInputRef} type="file" accept=".json" className="hidden" onChange={importBackup} />
                                    </label>
                                    <button onClick={exportCSV} className="w-full bg-blue-900/20 border border-blue-900/50 p-3 rounded-xl flex items-center justify-center gap-2 text-sm font-bold text-blue-400">
                                        <Icons.Activity className="w-4 h-4"/> Exportar CSV
                                    </button>
                                    <div className="pt-4 border-t border-slate-800 mt-2">
                                        <button onClick={() => { if(confirm("Apagar todos os dados locais?")) { localStorage.clear(); window.location.reload(); } }} className="w-full text-red-500 py-2 border border-slate-800 rounded-xl">Resetar Tudo</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* MODAL MEDIDAS (Reutilizado mas oculto no exemplo para brevidade, l√≥gica j√° existe) */}
                     {showMeasurements && (
                        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm p-4" onClick={() => setShowMeasurements(false)}>
                            <div className="bg-slate-900 border border-slate-800 w-full max-w-sm rounded-3xl p-6 relative slide-up h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold text-white flex items-center gap-2"><Icons.Ruler className="w-5 h-5"/> Medidas</h2>
                                    <button onClick={() => setShowMeasurements(false)} className="text-sm text-slate-400">Fechar</button>
                                </div>
                                <div className="space-y-6">
                                    <div><h3 className="text-xs font-bold text-slate-500 uppercase mb-3 border-b border-slate-800 pb-1">Tronco</h3><div className="grid grid-cols-2 gap-4"><MeasureInput label="T√≥rax" mKey="chest" val={dailyLog.measurements?.chest} update={updateMeasurement} /><MeasureInput label="Cintura" mKey="waist" val={dailyLog.measurements?.waist} update={updateMeasurement} /><MeasureInput label="Abdome" mKey="abdomen" val={dailyLog.measurements?.abdomen} update={updateMeasurement} /><MeasureInput label="Quadril" mKey="hip" val={dailyLog.measurements?.hip} update={updateMeasurement} /></div></div>
                                    <div><h3 className="text-xs font-bold text-slate-500 uppercase mb-3 border-b border-slate-800 pb-1">Membros Sup.</h3><div className="grid grid-cols-2 gap-4"><MeasureInput label="Bra√ßo E." mKey="armL" val={dailyLog.measurements?.armL} update={updateMeasurement} /><MeasureInput label="Bra√ßo D." mKey="armR" val={dailyLog.measurements?.armR} update={updateMeasurement} /><MeasureInput label="Antebr. E." mKey="forearmL" val={dailyLog.measurements?.forearmL} update={updateMeasurement} /><MeasureInput label="Antebr. D." mKey="forearmR" val={dailyLog.measurements?.forearmR} update={updateMeasurement} /></div></div>
                                     <div><h3 className="text-xs font-bold text-slate-500 uppercase mb-3 border-b border-slate-800 pb-1">Membros Inf.</h3><div className="grid grid-cols-2 gap-4"><MeasureInput label="Coxa E." mKey="thighL" val={dailyLog.measurements?.thighL} update={updateMeasurement} /><MeasureInput label="Coxa D." mKey="thighR" val={dailyLog.measurements?.thighR} update={updateMeasurement} /><MeasureInput label="Pantur. E." mKey="calfL" val={dailyLog.measurements?.calfL} update={updateMeasurement} /><MeasureInput label="Pantur. D." mKey="calfR" val={dailyLog.measurements?.calfR} update={updateMeasurement} /></div></div>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        // --- SUBCOMPONENTES ---
        function GoalInput({ label, val, change }) {
            return (
                <div className="bg-slate-800 p-2 rounded-lg border border-slate-700">
                    <label className="text-[10px] text-slate-400 block mb-1">{label}</label>
                    <input type="number" value={val} onChange={(e) => change(e.target.value)} className="bg-transparent text-lg font-bold text-white w-full outline-none" />
                </div>
            );
        }
        function QuickInput({ label, val, change, color="text-white" }) {
            return (
                <div className="flex flex-col items-center p-2 bg-slate-900 rounded-lg border border-slate-800">
                    <span className="text-[10px] text-slate-500 mb-1">{label}</span>
                    <input type="number" value={val} onChange={(e) => change(e.target.value)} className={`bg-transparent text-center font-bold w-full outline-none ${color}`} placeholder="-" />
                </div>
            );
        }
        function MeasureInput({ label, mKey, val, update }) {
            return (
                <div className="bg-slate-800 p-2 rounded-lg border border-slate-700">
                    <label className="text-[10px] text-slate-400 block mb-1">{label}</label>
                    <div className="flex items-center gap-1"><input type="number" value={val || ''} onChange={(e) => update(mKey, e.target.value)} className="bg-transparent text-lg font-bold text-white w-full outline-none" placeholder="-" /><span className="text-[10px] text-slate-600">cm</span></div>
                </div>
            );
        }
        function StatsBox({ label, value, target, color }) {
            const colors = { blue: 'bg-blue-500', purple: 'bg-purple-500' };
            const pct = Math.min(100, (value/target)*100);
            return (
                <div className="glass p-3 rounded-xl">
                    <div className="text-[10px] text-slate-400 uppercase font-bold mb-2">{label}</div>
                    <div className="flex items-end gap-1 mb-1"><span className="text-xl font-bold text-white">{value}</span><span className="text-xs text-slate-600">/{target}</span></div>
                    <div className="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden"><div className={`h-full ${colors[color]}`} style={{width: `${pct}%`}}></div></div>
                </div>
            );
        }
        function Charts({ history }) {
            const data = history.filter(h => h.weight).slice(0, 14).reverse();
            if (data.length < 2) return <div className="h-20 flex items-center justify-center text-xs text-slate-600">Sem dados suficientes</div>;
            const max = Math.max(...data.map(d => d.weight)) + 1;
            const min = Math.min(...data.map(d => d.weight)) - 1;
            const points = data.map((d, i) => {
                const x = (i / (data.length - 1)) * 100;
                const y = 100 - ((d.weight - min) / (max - min)) * 100;
                return `${x},${y}`;
            }).join(" ");
            return (
                <div className="h-24 w-full relative">
                    <svg className="w-full h-full overflow-visible" viewBox="0 0 100 100" preserveAspectRatio="none">
                        <polyline points={points} fill="none" stroke="#10b981" strokeWidth="2" vectorEffect="non-scaling-stroke"/>
                        {data.map((d, i) => <circle key={i} cx={(i/(data.length-1))*100} cy={100 - ((d.weight-min)/(max-min))*100} r="3" className="fill-slate-900 stroke-emerald-500" strokeWidth="2" vectorEffect="non-scaling-stroke" />)}
                    </svg>
                </div>
            );
        }
        function WorkoutCard({ title, icon, current, target, active, onClick, color }) {
            const themes = {
                cyan: { bg: 'bg-cyan-500/10', border: 'border-cyan-500/40', text: 'text-cyan-400', bar: 'bg-cyan-500' },
                orange: { bg: 'bg-orange-500/10', border: 'border-orange-500/40', text: 'text-orange-400', bar: 'bg-orange-500' },
                purple: { bg: 'bg-purple-500/10', border: 'border-purple-500/40', text: 'text-purple-400', bar: 'bg-purple-500' }
            };
            const t = themes[color];
            const pct = Math.min(100, (current/target)*100);
            return (
                <button onClick={onClick} className={`relative p-3 rounded-xl border flex flex-col items-center justify-between min-h-[100px] transition-all active:scale-95 ${active ? `${t.bg} ${t.border}` : 'bg-slate-800 border-slate-700'}`}>
                    <div className={`p-1.5 rounded-full mb-1 ${active ? 'bg-white/10 text-white' : 'bg-slate-700/50 text-slate-400'}`}><div className={`w-4 h-4 ${active ? t.text : ''}`}>{icon}</div></div>
                    <div className="text-center w-full z-10"><span className={`text-[10px] font-bold block uppercase tracking-wide ${active ? 'text-white' : 'text-slate-400'}`}>{title}</span><span className="text-[10px] text-slate-500 font-mono">{current}/{target}</span></div>
                    <div className="w-full h-1 bg-black/30 rounded-full mt-2 overflow-hidden"><div className={`h-full transition-all ${active ? t.bar : 'bg-slate-600'}`} style={{width: `${pct}%`}}></div></div>
                </button>
            );
        }
        function MacroRow({ label, type, val, target, color, text, update }) {
            const pct = Math.min(100, (val/target)*100);
            return (
                <div>
                    <div className="flex justify-between items-end mb-2">
                        <span className="text-xs font-bold text-slate-300">{label}</span>
                        <div className="flex items-center gap-1"><input type="number" value={val === 0 ? '' : val} onChange={(e) => update(type, e.target.value, true)} className={`bg-transparent text-right font-mono font-bold w-12 outline-none border-b border-dashed border-slate-700 focus:border-white ${text}`} placeholder="0" /><span className="text-xs text-slate-500 font-mono">/{target}g</span></div>
                    </div>
                    <div className="h-2 bg-slate-900 rounded-full overflow-hidden mb-2 border border-slate-700/50"><div className={`h-full ${color} transition-all duration-500`} style={{width: `${pct}%`}}></div></div>
                    <div className="flex justify-end gap-2">
                        <button onClick={() => update(type, -10)} className="h-6 px-2 bg-slate-800 rounded border border-slate-700 text-[10px] text-slate-400 hover:text-red-400">-10</button>
                        <button onClick={() => update(type, 10)} className="h-6 px-3 bg-slate-800 rounded border border-slate-600 text-[10px] text-white font-bold hover:bg-slate-700">+10</button>
                        <button onClick={() => update(type, 30)} className="h-6 px-3 bg-slate-800 rounded border border-slate-600 text-[10px] text-white font-bold hover:bg-slate-700">+30</button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

